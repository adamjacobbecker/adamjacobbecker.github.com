---
layout: post
title: A Perplexing Pagination Problem
---

<p>Say you've got a list of paginated messages, which is filtered to show unread messages only, and you're going through the first page, reading them and marking them as read one-by-one. What happens when you click "next"? With normal pagination you'd be taken to the second page. But wait, because the items on that first page no longer belong in the list of unread messages, the first page is now full of messages that are still unread!</p>

<p>I ran into this problem recently while working on <a href="https://github.com/presidential-innovation-fellows/hire-ez" target="_blank">Hire-EZ</a>, an open-source tool for reviewing and selecting applicants out of a larger pool. The solution? When the user clicks the "forward" button, we intercept the event and calculate how many visible messages no longer belong in the current filter. The code looks something like:</p>

{% highlight coffeescript %}
$(document).on "click", ".next", (e) ->
  total = $(this).data('total')
  href = $(this).data('href')
  filter = $(this).data('filter') || false

  params =
    skip: parseInt($wrapper.data('skip') || 0)
    sort: $wrapper.data('sort')
    query: $wrapper.data('query')

  # get the number of bids that are currently visible
  # but would no longer be included in the filter results
  no_longer_visible_count = 0

  Rfpez.Backbone.Bids.each (b) ->
    if filter is "unread"
      if b.attributes.read then no_longer_visible_count++
    else if filter is "starred"
      if !b.attributes.starred then no_longer_visible_count++

  # 10 results per page
  params.skip = (params.skip - no_longer_visible_count + 10)

  if params.skip < 1 then params.skip = false

  url = "#{href}?#{$.param(params)}"

  return $(@).attr 'href', url
{% endhighlight %}

<p>Yeah, it's a little complex, but the result ends up being pretty smooth. This one stumped me for a while, so if you've tackled this problem differently I'd love to see what you came up with.</p>

<div style="text-align: center;">
  <iframe width="420" height="315" src="http://www.youtube.com/embed/yAUzZiwVnys?rel=0" frameborder="0" allowfullscreen></iframe>
</div>

